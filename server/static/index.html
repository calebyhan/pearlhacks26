<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Visual911 ‚Äî Dispatcher</title>

  <!-- Chart.js for vitals graph -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <!-- Leaflet.js for map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #0a0a0f; color: #e0e0e0; font-family: 'SF Pro', system-ui, sans-serif; height: 100vh; display: flex; flex-direction: column; }

    #header {
      padding: 12px 20px;
      background: #111118;
      border-bottom: 1px solid #222;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    #header h1 { font-size: 16px; font-weight: 600; color: #fff; margin-left: auto; }

    #incoming-banner {
      display: none;
      background: #1a0000;
      border: 1px solid #ff3333;
      border-radius: 8px;
      padding: 10px 16px;
      align-items: center;
      gap: 12px;
    }
    #incoming-banner.visible { display: flex; }
    #incoming-banner .pulse { width: 10px; height: 10px; border-radius: 50%; background: #ff3333; animation: pulse 1s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    #answer-btn {
      background: #00cc44;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    #main-grid {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 280px 320px;
      grid-template-rows: 1fr 200px;
      gap: 1px;
      background: #222;
      overflow: hidden;
    }

    .panel {
      background: #0f0f18;
      padding: 16px;
      overflow: hidden;
    }
    .panel-title { font-size: 11px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: #666; margin-bottom: 12px; }

    /* Video panel */
    #video-panel { grid-row: 1; position: relative; }
    #remote-video { width: 100%; height: 100%; object-fit: cover; background: #000; border-radius: 4px; cursor: pointer; }
    #unmute-hint {
      position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #aaa; font-size: 11px;
      padding: 4px 10px; border-radius: 4px; pointer-events: none;
    }

    /* Vitals panel */
    #vitals-panel { grid-row: 1; }
    .vital-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
    .vital-label { font-size: 12px; color: #888; }
    .vital-value { font-size: 28px; font-weight: 700; color: #fff; }
    .vital-unit { font-size: 12px; color: #666; margin-left: 4px; }
    .confidence-bar { height: 4px; background: #222; border-radius: 2px; margin-bottom: 16px; }
    .confidence-fill { height: 100%; border-radius: 2px; background: #00cc44; transition: width 0.5s; }
    #signal-lost { display: none; color: #ff6600; font-size: 12px; text-align: center; padding: 8px; background: #1a0f00; border-radius: 4px; }
    #hr-chart-container { height: 100px; }

    /* Triage panel */
    #triage-panel { grid-row: 1; }
    .severity-bar { display: flex; gap: 4px; margin-bottom: 12px; }
    .severity-dot { flex: 1; height: 8px; border-radius: 2px; background: #222; }
    .severity-dot.active { background: #ff3333; }
    .severity-dot.active.low { background: #00cc44; }
    .severity-dot.active.mid { background: #ffaa00; }
    .triage-field { margin-bottom: 10px; }
    .triage-field-label { font-size: 10px; color: #555; text-transform: uppercase; letter-spacing: 0.06em; }
    .triage-field-value { font-size: 13px; color: #ddd; margin-top: 2px; }
    #critical-alert {
      display: none;
      background: #ff0000;
      color: white;
      font-weight: 700;
      font-size: 14px;
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 12px;
      animation: flashred 0.5s infinite;
    }
    @keyframes flashred { 0%, 100% { background: #ff0000; } 50% { background: #880000; } }

    /* Map panel */
    #map-panel { grid-column: 1 / -1; grid-row: 2; }
    #map { width: 100%; height: 100%; }

    /* End call */
    #end-call-btn {
      position: fixed;
      bottom: 216px;
      right: 20px;
      background: #cc0000;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: none;
    }
    #end-call-btn.visible { display: block; }

    body.critical-state { animation: criticalFlash 1s infinite; }
    @keyframes criticalFlash { 0%, 100% { border: 3px solid transparent; } 50% { border: 3px solid #ff0000; } }
  </style>
</head>
<body>

<div id="header">
  <div id="incoming-banner">
    <div class="pulse"></div>
    <span>Incoming call</span>
    <span id="incoming-location" style="color:#888;font-size:12px;"></span>
    <button id="answer-btn">ANSWER</button>
  </div>
  <h1>Visual911 ‚Äî Dispatcher</h1>
</div>

<div id="critical-alert" style="display:none;margin:8px 20px;border-radius:6px;text-align:center;padding:10px;font-weight:700;background:#ff0000;color:#fff;"></div>

<div id="main-grid">
  <div class="panel" id="video-panel">
    <div class="panel-title">Live Feed</div>
    <video id="remote-video" autoplay playsinline muted></video>
    <div id="unmute-hint">üîá Click video to unmute</div>
  </div>

  <div class="panel" id="vitals-panel">
    <div class="panel-title">Vitals</div>

    <div id="signal-lost">‚ö† Signal lost / low confidence</div>

    <div class="vital-row">
      <span class="vital-label">‚ù§ Heart Rate</span>
    </div>
    <div>
      <span class="vital-value" id="hr-value">--</span>
      <span class="vital-unit">bpm</span>
    </div>
    <div class="confidence-bar"><div class="confidence-fill" id="hr-conf" style="width:0%"></div></div>

    <div class="vital-row">
      <span class="vital-label">‚Üï Breathing Rate</span>
    </div>
    <div>
      <span class="vital-value" id="br-value">--</span>
      <span class="vital-unit">/min</span>
    </div>
    <div class="confidence-bar"><div class="confidence-fill" id="br-conf" style="width:0%"></div></div>

    <div style="font-size:10px;color:#555;margin-bottom:8px;">From 15s pre-call scan</div>

    <div id="hr-chart-container">
      <canvas id="hr-chart"></canvas>
    </div>
  </div>

  <div class="panel" id="triage-panel">
    <div class="panel-title">AI Triage</div>

    <div class="severity-bar">
      <div class="severity-dot" id="sev1"></div>
      <div class="severity-dot" id="sev2"></div>
      <div class="severity-dot" id="sev3"></div>
      <div class="severity-dot" id="sev4"></div>
      <div class="severity-dot" id="sev5"></div>
    </div>
    <div style="font-size:11px;color:#666;margin-bottom:12px;">Severity: <span id="severity-label">--</span>/5</div>

    <div class="triage-field">
      <div class="triage-field-label">Situation</div>
      <div class="triage-field-value" id="situation">Waiting for analysis...</div>
    </div>
    <div class="triage-field">
      <div class="triage-field-label">Caller State</div>
      <div class="triage-field-value" id="emotional-state">--</div>
    </div>
    <div class="triage-field">
      <div class="triage-field-label">Response Type</div>
      <div class="triage-field-value" id="response-type">--</div>
    </div>
    <div class="triage-field">
      <div class="triage-field-label">Can Speak</div>
      <div class="triage-field-value" id="can-speak">--</div>
    </div>
    <div class="triage-field">
      <div class="triage-field-label">Keywords</div>
      <div class="triage-field-value" id="keywords">--</div>
    </div>
  </div>

  <div class="panel" id="map-panel">
    <div id="map"></div>
  </div>
</div>

<button id="end-call-btn">END CALL</button>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let ws = null;
let peerConnection = null;
let currentCallId = null;
let map = null;
let mapMarker = null;

// ‚îÄ‚îÄ‚îÄ Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const hrCtx = document.getElementById('hr-chart').getContext('2d');
const hrLabels = Array(30).fill('');
const hrData = Array(30).fill(null);
const hrChart = new Chart(hrCtx, {
  type: 'line',
  data: {
    labels: hrLabels,
    datasets: [{
      data: hrData,
      borderColor: '#ff4444',
      backgroundColor: 'rgba(255,68,68,0.1)',
      borderWidth: 2,
      tension: 0.3,
      pointRadius: 0,
      fill: true,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: { x: { display: false }, y: { min: 40, max: 200, display: false } },
    plugins: { legend: { display: false } },
    animation: { duration: 300 },
  }
});

function pushHRSample(value) {
  hrData.shift();
  hrData.push(value);
  hrChart.update();
}

// ‚îÄ‚îÄ‚îÄ Map ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initMap() {
  map = L.map('map').setView([35.9, -79.05], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  }).addTo(map);
}

function updateMapPin(lat, lng) {
  if (!map) initMap();
  const latlng = [lat, lng];
  if (mapMarker) {
    mapMarker.setLatLng(latlng);
  } else {
    mapMarker = L.marker(latlng).addTo(map).bindPopup('Caller location').openPopup();
  }
  map.setView(latlng, 15);
}

// ‚îÄ‚îÄ‚îÄ WebRTC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const iceServers = [
  { urls: 'stun:stun.l.google.com:19302' },
  { urls: 'stun:stun1.l.google.com:19302' },
];

function createPeerConnection() {
  peerConnection = new RTCPeerConnection({ iceServers });

  peerConnection.onicecandidate = (event) => {
    if (event.candidate && ws) {
      console.log('Sending ICE:', event.candidate.candidate.substring(0, 80));
      ws.send(JSON.stringify({
        type: 'ice',
        call_id: currentCallId,
        candidate: event.candidate.candidate,
        sdpMid: event.candidate.sdpMid,
        sdpMLineIndex: event.candidate.sdpMLineIndex
      }));
    }
  };

  peerConnection.ontrack = (event) => {
    console.log('Got remote track:', event.track.kind, event.streams.length, 'streams');
    const video = document.getElementById('remote-video');
    if (!video.srcObject) {
      video.srcObject = event.streams[0];
      video.play().then(() => console.log('Video playing')).catch(e => console.error('Play failed:', e));
    }
    event.track.onunmute = () => console.log('Track unmuted:', event.track.kind);
    event.track.onended = () => console.log('Track ended:', event.track.kind);
    // Log video dimensions once they're available
    if (event.track.kind === 'video') {
      video.onloadedmetadata = () => console.log('Video resolution:', video.videoWidth, 'x', video.videoHeight);
    }
    // Video starts muted (browser autoplay policy). Click to unmute.
    video.onclick = () => {
      video.muted = !video.muted;
      document.getElementById('unmute-hint').textContent =
        video.muted ? 'üîá Click video to unmute' : 'üîä Click video to mute';
    };
  };

  peerConnection.oniceconnectionstatechange = () => {
    console.log('ICE state:', peerConnection.iceConnectionState);
  };
  peerConnection.onconnectionstatechange = () => {
    console.log('WebRTC state:', peerConnection.connectionState);
    if (peerConnection.connectionState === 'connected') {
      const video = document.getElementById('remote-video');
      console.log('Video element:', 'srcObject:', !!video.srcObject, 'readyState:', video.readyState,
        'paused:', video.paused, 'videoWidth:', video.videoWidth, 'videoHeight:', video.videoHeight);
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(t =>
          console.log('  Track:', t.kind, 'enabled:', t.enabled, 'muted:', t.muted, 'readyState:', t.readyState));
      }
      video.play().catch(e => console.error('Force play failed:', e));
    }
  };
}

async function handleOffer(offerData) {
  createPeerConnection();
  await peerConnection.setRemoteDescription({ type: 'offer', sdp: offerData.sdp });
  const answer = await peerConnection.createAnswer();
  await peerConnection.setLocalDescription(answer);
  ws.send(JSON.stringify({
    type: 'answer',
    call_id: currentCallId,
    sdp: answer.sdp
  }));
}

// ‚îÄ‚îÄ‚îÄ Dashboard WebSocket ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function connectDashboard() {
  const wsProto = window.location.protocol === 'https:' ? 'wss' : 'ws';
  const wsUrl = `${wsProto}://${window.location.host}/ws/dashboard`;
  ws = new WebSocket(wsUrl);

  ws.onopen = () => console.log('Dashboard WS connected');

  ws.onmessage = async (event) => {
    const data = JSON.parse(event.data);

    switch (data.type) {
      case 'incoming_call':
        onIncomingCall(data);
        break;
      case 'dispatcher_ready':
        break;
      case 'triage_update':
        onTriageUpdate(data.report);
        break;
      case 'critical_flag':
        onCriticalFlag(data);
        break;
      case 'vitals':
        onVitals(data);
        break;
      case 'call_ended':
        onCallEnded(data);
        break;
      case 'offer':
        if (data.call_id) currentCallId = data.call_id;
        await handleOffer(data);
        break;
      case 'ice':
        if (peerConnection) {
          await peerConnection.addIceCandidate({
            candidate: data.candidate,
            sdpMid: data.sdpMid,
            sdpMLineIndex: data.sdpMLineIndex
          });
        }
        break;
    }
  };

  ws.onclose = () => {
    console.log('Dashboard WS closed, reconnecting in 2s...');
    setTimeout(connectDashboard, 2000);
  };
}

// ‚îÄ‚îÄ‚îÄ Event Handlers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onIncomingCall(data) {
  currentCallId = data.call_id;
  const banner = document.getElementById('incoming-banner');
  banner.classList.add('visible');

  const loc = data.location;
  if (loc?.lat) {
    document.getElementById('incoming-location').textContent =
      `üìç ${loc.lat.toFixed(4)}, ${loc.lng.toFixed(4)}`;
    updateMapPin(loc.lat, loc.lng);
  }
}

document.getElementById('answer-btn').onclick = () => {
  if (!currentCallId || !ws) return;
  document.getElementById('incoming-banner').classList.remove('visible');
  document.getElementById('end-call-btn').classList.add('visible');

  ws.send(JSON.stringify({
    type: 'dispatcher_joined',
    call_id: currentCallId
  }));
};

document.getElementById('end-call-btn').onclick = () => {
  if (!ws || !currentCallId) return;
  ws.send(JSON.stringify({ type: 'call_ended', call_id: currentCallId }));
  onCallEnded({ reason: 'dispatcher_ended' });
};

function onVitals(data) {
  const hrConf = data.hrConfidence ?? 0;
  const brConf = data.breathingConfidence ?? 0;
  const signalLost = document.getElementById('signal-lost');

  // Show warning only if both readings are low-confidence
  signalLost.style.display = (hrConf < 0.7 && brConf < 0.7) ? 'block' : 'none';

  // Update each vital independently based on its own confidence
  if (hrConf >= 0.7) {
    document.getElementById('hr-value').textContent = Math.round(data.hr);
    document.getElementById('hr-conf').style.width = `${Math.round(hrConf * 100)}%`;
    pushHRSample(data.hr);
  }
  if (brConf >= 0.7) {
    document.getElementById('br-value').textContent = Math.round(data.breathing);
    document.getElementById('br-conf').style.width = `${Math.round(brConf * 100)}%`;
  }
}

function onTriageUpdate(report) {
  document.getElementById('situation').textContent = report.situation_summary ?? '--';
  document.getElementById('emotional-state').textContent = report.caller_emotional_state ?? '--';
  document.getElementById('response-type').textContent = report.recommended_response_type ?? '--';
  document.getElementById('can-speak').textContent = report.can_speak ? 'Yes' : 'No';
  document.getElementById('keywords').textContent = (report.detected_keywords ?? []).join(', ') || '--';
  document.getElementById('severity-label').textContent = report.severity ?? '--';

  // Update severity dots
  for (let i = 1; i <= 5; i++) {
    const dot = document.getElementById(`sev${i}`);
    dot.className = 'severity-dot';
    if (i <= (report.severity ?? 0)) {
      dot.classList.add('active');
      if (report.severity <= 2) dot.classList.add('low');
      else if (report.severity <= 3) dot.classList.add('mid');
    }
  }

  if ((report.severity ?? 0) >= 4) {
    document.body.classList.add('critical-state');
  } else {
    document.body.classList.remove('critical-state');
  }
}

function onCriticalFlag(data) {
  const alert = document.getElementById('critical-alert');
  alert.textContent = `‚ö† CRITICAL: ${data.reason}`;
  alert.style.display = 'block';
  playAlert();
  setTimeout(() => { alert.style.display = 'none'; }, 10000);
}

function onCallEnded(data) {
  document.getElementById('end-call-btn').classList.remove('visible');
  document.getElementById('incoming-banner').classList.remove('visible');
  document.body.classList.remove('critical-state');
  document.getElementById('critical-alert').style.display = 'none';
  if (peerConnection) {
    peerConnection.close();
    peerConnection = null;
  }
  document.getElementById('remote-video').srcObject = null;
  currentCallId = null;
  document.getElementById('situation').textContent = 'Call ended';
}

function playAlert() {
  try {
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = 880;
    gain.gain.setValueAtTime(0.3, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
    osc.start();
    osc.stop(ctx.currentTime + 0.5);
  } catch (e) {}
}

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
initMap();
connectDashboard();
</script>
</body>
</html>
